from __future__ import division, print_function

import os
import sys
import logging

from .scheduling import exec_on_main_thread_async

@exec_on_main_thread_async
def log(message, level=logging.INFO):
    """
    Log to the appropriate stream, based on the level.

    Level should be one of the constants like logging.INFO

    If Unity is available, log to Unity. Otherwise just stdout.

        INFO => Debug.Log
        WARNING => Debug.LogWarning
        ERROR => Debug.LogError

    """
    if level < logging.INFO:
        print(message)
        sys.stdout.flush()
        return

    try:
        import UnityEngine
    except ImportError:
        # We're not actually running in Unity, so stdout it is.
        print(message)
        sys.stdout.flush()
    else:
        # Log to the appropriate Unity console
        if level == logging.INFO:
            UnityEngine.Debug.Log(message)
        elif level == logging.WARNING:
            UnityEngine.Debug.LogWarning(message)
        else: # level >= logging.ERROR
            UnityEngine.Debug.LogError(message)
